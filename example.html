<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Squarified Example</title>
    <style>
    #app, html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      height: 100%;
      width: 100%;
    }
    p {
      margin: 0;
      padding: 0;
    }
    </style>
  </head>
  <body>
    <div id="app"></div>
    
<script>"use strict";(()=>{var Rt=Math.PI/180,ce=Math.PI*2,N={a:1,b:0,c:0,d:1,e:0,f:0},B=class{a;b;c;d;e;f;constructor(t={}){this.a=t.a||1,this.b=t.b||0,this.c=t.c||0,this.d=t.d||1,this.e=t.e||0,this.f=t.f||0}create(t){return Object.assign(this,t),this}transform(t,n,i,o,r,a,s){return this.scale(i,o).translation(t,n),a||s?this.skew(a,s):this.roate(r),this}transformPoint(t,n){return{x:this.a*t+this.c*n+this.e,y:this.b*t+this.d*n+this.f}}translation(t,n){return this.e+=t,this.f+=n,this}scale(t,n){return this.a*=t,this.d*=n,this}skew(t,n){let i=Math.tan(t*Rt),o=Math.tan(n*Rt),r=this.a+this.b*i,a=this.b+this.a*o,s=this.c+this.d*i,l=this.d+this.c*o;return this.a=r,this.b=a,this.c=s,this.d=l,this}roate(t){if(t>0){let n=t*Rt,i=Math.cos(n),o=Math.sin(n),r=this.a*i-this.b*o,a=this.a*o+this.b*i,s=this.c*i-this.d*o,l=this.c*o+this.d*i;this.a=r,this.b=a,this.c=s,this.d=l}return this}};var _e={id:0,get(){return this.id++}};var it=class{parent;id;matrix;constructor(t){this.parent=null,this.id=t??_e.get(),this.matrix=new B}destory(){}},C={fillStyle:1,strokeStyle:2,font:4,lineWidth:8,textAlign:16,textBaseline:32},Be=C.fillStyle|C.strokeStyle|C.font|C.lineWidth|C.textAlign|C.textBaseline,S=0;function Ne(){return{mods:[],fillStyle(...e){this.mods.push({mod:["fillStyle",e],type:C.fillStyle})},fillRect(...e){this.mods.push({mod:["fillRect",e],type:S})},strokeStyle(...e){this.mods.push({mod:["strokeStyle",e],type:C.strokeStyle})},lineWidth(...e){this.mods.push({mod:["lineWidth",e],type:C.lineWidth})},strokeRect(...e){this.mods.push({mod:["strokeRect",e],type:S})},fillText(...e){this.mods.push({mod:["fillText",e],type:S})},font(...e){this.mods.push({mod:["font",e],type:C.font})},textBaseline(...e){this.mods.push({mod:["textBaseline",e],type:C.textBaseline})},textAlign(...e){this.mods.push({mod:["textAlign",e],type:C.textAlign})},beginPath(){this.mods.push({mod:["beginPath",[]],type:S})},moveTo(...e){this.mods.push({mod:["moveTo",e],type:S})},arcTo(...e){this.mods.push({mod:["arcTo",e],type:S})},closePath(){this.mods.push({mod:["closePath",[]],type:S})},fill(){this.mods.push({mod:["fill",[]],type:S})},stroke(){this.mods.push({mod:["stroke",[]],type:S})},drawImage(...e){this.mods.push({mod:["drawImage",e],type:S})}}}var At=class extends it{width;height;x;y;scaleX;scaleY;rotation;skewX;skewY;constructor(t={}){super(t.__id__),this.width=t.width||0,this.height=t.height||0,this.x=t.x||0,this.y=t.y||0,this.scaleX=t.scaleX||1,this.scaleY=t.scaleY||1,this.rotation=t.rotation||0,this.skewX=t.skewX||0,this.skewY=t.skewY||0}},j=class extends At{instruction;__options__;__widget__;constructor(t={},n){super(t),this.instruction=Ne(),this.__options__=t,this.__widget__=n}render(t){this.create();let n=this.instruction.mods.length;for(let i=0;i<n;i++){let{mod:o,type:r}=this.instruction.mods[i],[a,...s]=o;if(r&Be){t[a]=s[0];continue}t[a].apply(t,...s)}}get __instanceOf__(){return"Graph"}};function It(e){return e.__instanceOf__==="Graph"}function Lt(e){return e.__instanceOf__==="Box"}function St(e){return It(e)&&e.__shape__==="RoundRect"}function _t(e){return It(e)&&e.__shape__==="Text"}var T={isGraph:It,isBox:Lt,isText:_t,isRoundRect:St};var Bt=class extends it{elements;constructor(t){super(t),this.elements=[]}add(...t){let n=t.length;for(let i=0;i<n;i++){let o=t[i];o.parent,this.elements.push(o),o.parent=this}}remove(...t){let n=t.length;for(let i=0;i<n;i++)for(let o=this.elements.length-1;o>=0;o--){let r=this.elements[o];r.id===t[i].id&&(this.elements.splice(o,1),r.parent=null)}}destory(){this.elements.forEach(t=>t.parent=null),this.elements.length=0}},k=class e extends Bt{elements;constructor(t){super(t),this.elements=[]}add(...t){let n=t.length;for(let i=0;i<n;i++){let o=t[i];o.parent,this.elements.push(o),o.parent=this}}remove(...t){let n=t.length;for(let i=0;i<n;i++)for(let o=this.elements.length-1;o>=0;o--){let r=this.elements[o];r.id===t[i].id&&(this.elements.splice(o,1),r.parent=null)}}destory(){this.elements.forEach(t=>t.parent=null),this.elements.length=0}get __instanceOf__(){return"Box"}clone(){let t=new e(this.id);if(this.elements.length){let n=[{elements:this.elements,parent:t}];for(;n.length>0;){let{elements:i,parent:o}=n.pop(),r=i.length;for(let a=0;a<r;a++){let s=i[a];if(T.isBox(s)){let l=new e;l.parent=o,o.add(l),n.push({elements:s.elements,parent:l})}else if(T.isGraph(s)){let l=s.clone();l.parent=o,o.add(l)}}}}return t}};function ke(e){let{h:t,l:n,s:i,a:o}=e;return"a"in e?`hsla(${t}deg, ${i}%, ${n}%, ${o})`:`hsl(${t}deg, ${i}%, ${n}%)`}function Ge(e){let{r:t,g:n,b:i,a:o}=e;return"a"in e?`rgba(${t}, ${n}, ${i}, ${o})`:`rgb(${t}, ${n}, ${i})`}function He(e){return e.mode==="rgb"?Ge(e.desc):ke(e.desc)}function Fe(e,t=1){let n={mode:e.mode,desc:{...e.desc,a:t}};return He(n)}var ue={evaluateFillStyle:Fe};var ot=class e extends j{style;constructor(t={},n){super(t,n),this.style=t.style||Object.create(null)}get __shape__(){return"RoundRect"}create(){let t=this.style.padding,n=0,i=0,o=this.width-t*2,r=this.height-t*2,a=this.style.radius||0;this.instruction.beginPath(),this.instruction.moveTo(n+a,i),this.instruction.arcTo(n+o,i,n+o,i+r,a),this.instruction.arcTo(n+o,i+r,n,i+r,a),this.instruction.arcTo(n,i+r,n,i,a),this.instruction.arcTo(n,i,n+o,i,a),this.instruction.closePath(),this.style.fill&&(this.instruction.closePath(),this.instruction.fillStyle(ue.evaluateFillStyle(this.style.fill,this.style.opacity)),this.instruction.fill()),this.style.stroke&&(typeof this.style.lineWidth=="number"&&this.instruction.lineWidth(this.style.lineWidth),this.instruction.strokeStyle(this.style.stroke),this.instruction.stroke())}clone(){return new e({...this.style,...this.__options__,__id__:this.id},this.__widget__)}};var rt=class e extends j{text;style;constructor(t={},n){super(t,n),this.text=t.text||"",this.style=t.style||Object.create(null)}create(){this.style.fill&&(this.instruction.font(this.style.font),this.instruction.lineWidth(this.style.lineWidth),this.instruction.textBaseline(this.style.baseline),this.instruction.textAlign(this.style.textAlign),this.instruction.fillStyle(this.style.fill),this.instruction.fillText(this.text,0,0))}clone(){return new e({...this.style,...this.__options__,__id__:this.id},this.__widget__)}get __shape__(){return"Text"}};function st(e,t){let n=e.length;for(let i=0;i<n;i++){let o=e[i];T.isGraph(o)?t(o):T.isBox(o)&&st(o.elements,t)}}var he={linear:e=>e,quadraticIn:e=>e*e,quadraticOut:e=>e*(2-e),quadraticInOut:e=>(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1),cubicIn:e=>e*e*e,cubicOut:e=>(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2),cubicInOut:e=>(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)};var G=class{eventCollections;constructor(){this.eventCollections=Object.create(null)}on(t,n,i){t in this.eventCollections||(this.eventCollections[t]=[]);let o={name:t,handler:n,ctx:i||this,silent:!1};this.eventCollections[t].push(o)}off(t,n){if(t in this.eventCollections){if(!n){this.eventCollections[t]=[];return}this.eventCollections[t]=this.eventCollections[t].filter(i=>i.handler!==n)}}silent(t,n){t in this.eventCollections&&this.eventCollections[t].forEach(i=>{(!n||i.handler===n)&&(i.silent=!0)})}active(t,n){t in this.eventCollections&&this.eventCollections[t].forEach(i=>{(!n||i.handler===n)&&(i.silent=!1)})}emit(t,...n){if(!this.eventCollections[t])return;let i=this.eventCollections[t];i.length&&i.forEach(o=>{o.silent||o.handler.call(o.ctx,...n)})}bindWithContext(t){return(n,i)=>this.on(n,i,t)}};function qe(e){let t=0,n=0;if(document.documentElement.getBoundingClientRect&&e.getBoundingClientRect){let{top:i,left:o}=e.getBoundingClientRect();t=i,n=o}else for(let i=e;i;i=e.offsetParent)t+=e.offsetLeft,n+=e.offsetTop;return[t+Math.max(document.documentElement.scrollLeft,document.body.scrollLeft),n+Math.max(document.documentElement.scrollTop,document.body.scrollTop)]}function de(e,t,n,i,o,r){let a=e.getBoundingClientRect();if(t instanceof MouseEvent){let[s,l]=qe(e);return{x:(t.clientX-a.left-s-o)/n,y:(t.clientY-a.top-l-r)/i}}return{x:0,y:0}}function Xe(e){return t=>{let n=()=>{t()||(e.animationFrameID=Nt(n))};e.animationFrameID||(e.animationFrameID=Nt(n))}}function Ye(e){return()=>{e.animationFrameID&&(window.cancelAnimationFrame(e.animationFrameID),e.animationFrameID=null)}}function pe(){let e={animationFrameID:null},t=Xe(e),n=Ye(e);return{run:t,stop:n}}function at(e){let t=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);t=(t<<5)-t+i,t=t&t}return t}function kt(e){return typeof e=="number"?!0:e.charCodeAt(0)>=48&&e.charCodeAt(0)<=57}function mt(e,t,n,i,o,r){return new ot({width:n,height:i,x:e,y:t,style:{...o}},r)}function me(e,t,n,i,o,r){return new rt({text:e,x:t,y:n,style:{fill:o,textAlign:"center",baseline:"middle",font:i,lineWidth:1}},r)}var Nt=window.requestAnimationFrame;function fe(){return document.createElement("canvas")}function Gt(e,t,n){e.setTransform(t.a*n,t.b*n,t.c*n,t.d*n,t.e*n,t.f*n)}function ft(e,t){return t.forEach(({name:n,fn:i})=>{Object.defineProperty(e,n,{value:i(e),writable:!1,enumerable:!0})}),e}function lt(e,t,n,i){e.x=e.x*i+t,e.y=e.y*i+n,e.scaleX=i,e.scaleY=i}function gt(e,t,n,i){st(e,o=>lt(o,t,n,i))}function H(e,t){let n=pe(),i=Date.now(),o=r=>Array.isArray(t.deps)?t.deps.some(a=>a()):r>=1;n.run(()=>{let r=Date.now()-i,a=Math.min(r/t.duration,1);return o(a)?(n.stop(),t.onStop&&t.onStop(),!0):e(a,n.stop)})}function ge(e){return e.which===2||e.which===3}var pt=class extends Map{defaultFactory;constructor(t,n){super(n),this.defaultFactory=t}get(t){return super.has(t)?super.get(t):this.defaultFactory()}getOrInsert(t,n){if(!super.has(t)){let i=n||this.defaultFactory();return super.set(t,i),i}return super.get(t)}};var yt=e=>({error:t=>console.error(`[${e}] ${t}`),panic:t=>{throw new Error(`[${e}] ${t}`)}});function ye(e,t,n){e==null&&t.panic(n)}var ze="etoile",xe=yt(ze);function We(e,t,n,i){e.width=t*i,e.height=n*i,e.style.cssText=`width: ${t}px; height: ${n}px`}var Ht=class{canvas;ctx;constructor(t){this.canvas=fe(),this.setOptions(t),this.ctx=this.canvas.getContext("2d")}setOptions(t){We(this.canvas,t.width,t.height,t.devicePixelRatio)}},xt=class{options;container;constructor(t,n){this.container=new Ht(n),this.options=n,this.initOptions(n),n.shaow||t.appendChild(this.container.canvas)}clear(t,n){this.ctx.clearRect(0,0,t,n)}get canvas(){return this.container.canvas}get ctx(){return this.container.ctx}initOptions(t={}){Object.assign(this.options,t),this.container.setOptions(this.options)}destory(){}};function Me(e,t,n){let{ctx:i,dpr:o}=t;if(!(T.isGraph(e)&&n&&!n.has(e.id))){if(T.isBox(e)){let r=e.elements;for(let a=0;a<r.length;a++){let s=r[a];T.isGraph(s)&&n&&!n.has(s.id)||Me(s,t,n)}return}if(T.isGraph(e)){i.save();let r=e.matrix.create({a:1,b:0,c:0,d:1,e:0,f:0});r.transform(e.x,e.y,e.scaleX,e.scaleY,e.rotation,e.skewX,e.skewY),Gt(i,r,o),e.render(i),i.restore()}}}function Ft(e,t){return!(e.x+e.width<t.x||e.x>t.x+t.width||e.y+e.height<t.y||e.y>t.y+t.height)}var qt=class e{boundary;capacity;objects;divided;northeast;northwest;southeast;southwest;constructor(t,n=8){this.boundary=t,this.capacity=n,this.objects=[],this.divided=!1}insert(t,n){return Ft(this.boundary,t)?this.objects.length<this.capacity?(this.objects.push({bbox:t,obj:n}),!0):(this.divided||this.subdivide(),this.northeast.insert(t,n)||this.northwest.insert(t,n)||this.southeast.insert(t,n)||this.southwest.insert(t,n)):!1}subdivide(){let{x:t,y:n,width:i,height:o}=this.boundary,r=i/2,a=o/2;this.northeast=new e({x:t+r,y:n,width:r,height:a},this.capacity),this.northwest=new e({x:t,y:n,width:r,height:a},this.capacity),this.southeast=new e({x:t+r,y:n+a,width:r,height:a},this.capacity),this.southwest=new e({x:t,y:n+a,width:r,height:a},this.capacity),this.divided=!0}query(t,n=[]){if(!Ft(this.boundary,t))return n;for(let{bbox:i,obj:o}of this.objects)Ft(i,t)&&n.push(o);return this.divided&&(this.northeast.query(t,n),this.northwest.query(t,n),this.southeast.query(t,n),this.southwest.query(t,n)),n}};function ve(e,t){let n=[],i=t??new B;if(T.isGraph(e)){let o=e.x??0,r=e.y??0,a=e.width??0,s=e.height??0,l=i.transformPoint(o,r),c=i.transformPoint(o+a,r+s),h={x:Math.min(l.x,c.x),y:Math.min(l.y,c.y),width:Math.abs(c.x-l.x),height:Math.abs(c.y-l.y)};n.push({bbox:h,obj:e})}if(T.isBox(e)){let o=e.elements,r=o.length;for(let a=0;a<r;a++){let s=o[a];n.push(...ve(s,i))}}return n}var K=class extends k{render;to;event;quadTree;constructor(t,n={}){super(),this.to=typeof t=="string"?document.querySelector(t):t,this.to||xe.panic("The element to bind is not found.");let{width:i,height:o}=this.to.getBoundingClientRect();Object.assign(n,{width:i,height:o},{devicePixelRatio:window.devicePixelRatio||1}),this.event=new G,this.render=new xt(this.to,n)}update(){this.render.clear(this.render.options.width,this.render.options.height);let t=ve(this),n={x:0,y:0,width:this.render.options.width,height:this.render.options.height};this.quadTree=new qt(n);let i=t.length;for(let a=0;a<i;a++){let{bbox:s,obj:l}=t[a];this.quadTree.insert(s,l)}let o;if(this.quadTree){let a=this.quadTree.query(n);o=new Set(a.map(s=>s.id))}this.execute(this.render,this,o);let r=this.matrix.create({a:1,b:0,c:0,d:1,e:0,f:0});Gt(this.render.ctx,r,this.render.options.devicePixelRatio)}execute(t,n=this,i){Me(n,{c:t.canvas,ctx:t.ctx,dpr:t.options.devicePixelRatio},i)}};function Mt(e,...t){return e.sort((n,i)=>{for(let o of t){let r=n[o],a=i[o];if(kt(r)&&kt(a)){if(a>r)return 1;if(a<r)return-1;continue}let s=(""+r).localeCompare(""+a);if(s!==0)return s}return 0})}function vt(e,t,n){Array.isArray(e.groups)&&(e.groups=Mt(e.groups.map(o=>vt(o,t,n)),"weight"));let i={...e,weight:e[t]};return n&&Object.assign(i,n(i)),i}function Xt(e,t){return e.map(n=>{let i={...n};return i.parent=t,i.groups&&Array.isArray(i.groups)&&(i.groups=Xt(i.groups,i)),i})}function Yt(e){let t=0;for(;e.parent;)e=e.parent,t++;return t}function bt(e,t){if(!e)return null;for(let n of e){if(n.children){let o=bt(n.children,t);if(o)return o}if(t(n))return n}return null}function zt(e,t){return bt(t,n=>{let[i,o,r,a]=n.layout;if(e.x>=i&&e.y>=o&&e.x<i+r&&e.y<o+a)return!0})}function Wt(e,t){return bt(t,n=>{if(n.node.id===e)return!0})}function Ve(e,t){let n=t.map(i=>i.id).sort().join("-");return Math.abs(at(n))+"-"+e}function je(e,t,n,i){if(!e||!e.length)return[];let o=e.reduce((s,l)=>s+l.weight,0);if(o<=0)return[];let r=[],a=[];if(e.forEach(s=>{let l=s.weight/o*t;Math.sqrt(l)<n||l<i?a.push({...s}):r.push({...s})}),a.length>0){let s=a.reduce((l,c)=>l+c.weight,0);if(s>0&&s/o*t>=i){let l={id:`combined-node-${Ve(s,a)}`,weight:s,isCombinedNode:!0,originalNodeCount:a.length,parent:null,groups:[],originalNodes:a};r.push(l)}}return r}function Vt(e,t,n,i=1){let o=[];if(!e.length)return o;let r=t.w*t.h,a=Math.min(t.w,t.h),s=Math.max(.5,Math.min(1,a/800)),c=Math.max(8,20/Math.sqrt(i)),h=c*c,d=n.rectGap*s,f=n.rectRadius*s,m=je(e,r,c,h);if(!m.length)return o;let p=t;d>0&&(p={x:t.x+d/2,y:t.y+d/2,w:Math.max(0,t.w-d),h:Math.max(0,t.h-d)});let y=(g,u,x,b,M)=>{let A=m[g].weight*M,Y=m[u].weight*M;return Math.max(x*x*A/(b*b),b*b/(x*x*Y))};return((g,u,x=0)=>{let b=Math.max(.4,1-x*.15),M=d*b,A=f*b;for(;g<m.length;){let Y=0;for(let O=g;O<m.length;O++)Y+=m[O].weight;let F=Math.min(u.w,u.h),z=u.w*u.h/Y,R=g,E=0,J=0;for(;R<m.length;){let O=m[R].weight*z||0,ht=y(g,R,F,E+O,z);if(R>g&&J<ht)break;E+=O,J=ht,R++}let v=Math.round(E/F),tt=0,W=u.w>=u.h;for(let O=g;O<R;O++){let ht=O===g,Le=O===R-1,V=m[O],oe=V.weight*z,dt=Math.round(F*tt/E),re=Math.round(F*(tt+oe)/E),et,nt,P,I;if(W?(et=u.x,nt=u.y+dt,P=v,I=re-dt):(et=u.x+dt,nt=u.y,P=re-dt,I=v),M>0){let L=M/2;ht||(W?(nt+=L,I=Math.max(0,I-L)):(et+=L,P=Math.max(0,P-L))),Le||(W?I=Math.max(0,I-L):P=Math.max(0,P-L))}let Se=Yt(V)||1,{titleAreaHeight:Ot}=n,se=Ot.max/Se,Ct=se<Ot.min?Ot.min:se;P=Math.max(1,P),I=Math.max(1,I);let ae=[];if(V.groups&&V.groups.length>0){let L=M>0?M:0,wt={x:et+L,y:nt+Ct,w:Math.max(0,P-L*2),h:Math.max(0,I-Ct-L)},le=A>0?A*2:1;wt.w>=le&&wt.h>=le&&(ae=Vt(V.groups||[],wt,{...n,rectGap:M,rectRadius:A},i))}o.push({layout:[et,nt,P,I],node:V,children:ae,config:{titleAreaHeight:Ct,rectGap:M,rectRadius:A}}),tt+=oe}g=R;let _=M>0?M:0;W?(u.x+=v+_,u.w=Math.max(0,u.w-v-_)):(u.y+=v+_,u.h=Math.max(0,u.h-v-_))}})(0,p),o}var Tt=class{plugins=new Map;pluginContext;constructor(t){this.pluginContext={resolveModuleById(n){return Wt(n,t.layoutNodes)},getPluginMetadata:n=>this.getPluginMetadata(n),get instance(){return t}}}use(t){if(!t.name){q.error("Plugin name is required");return}this.plugins.has(t.name)&&q.panic(`Plugin ${t.name} is already registered`),this.plugins.set(t.name,t)}runHook(t,...n){this.plugins.forEach(i=>{let o=i[t];o&&o.apply(this.pluginContext,n)})}cascadeHook(t,...n){let i={};return this.plugins.forEach(o=>{let r=o[t];if(r){let a=r.call(this.pluginContext,...n);a&&Object.assign(i,a)}}),i}getPluginMetadata(t){return this.plugins.get(t)?.meta||null}};var q=yt("Treemap"),Ke={mode:"rgb",desc:{r:0,g:0,b:0}},$e={min:30,max:60},Dt=4,Ze=4,Ue={max:70,min:12},Qe="sans-serif",Je="#000",ct=class extends K{pluginDriver;data;colorMappings;rectLayer;textLayer;layoutNodes;config;caches;constructor(t,...n){super(...n),this.data=[],this.config=t,this.colorMappings={},this.pluginDriver=new Tt(this),this.rectLayer=new k,this.textLayer=new k,this.caches=new pt(()=>14),this.layoutNodes=[]}clearFontCacheInAABB(t){let n=this.getModulesInAABB(this.layoutNodes,t);for(let i of n)this.caches.delete(i.node.id)}getModulesInAABB(t,n){let i=[];for(let o of t){let[r,a,s,l]=o.layout,c={x:r,y:a,width:s,height:l};this.isAABBIntersecting(c,n)&&(i.push(o),o.children&&o.children.length>0&&i.push(...this.getModulesInAABB(o.children,n)))}return i}getViewportAABB(t,n){let{width:i,height:o}=this.render.options,r=-t,a=-n;return{x:r,y:a,width:i,height:o}}getAABBUnion(t,n){let i=Math.min(t.x,n.x),o=Math.min(t.y,n.y),r=Math.max(t.x+t.width,n.x+n.width),a=Math.max(t.y+t.height,n.y+n.height);return{x:i,y:o,width:r-i,height:a-o}}handleTransformCacheInvalidation(t,n){let i=this.getViewportAABB(t.e,t.f),o=this.getViewportAABB(n.e,n.f),r=this.getAABBUnion(i,o);this.clearFontCacheInAABB(r)}isAABBIntersecting(t,n){return!(t.x+t.width<n.x||n.x+n.width<t.x||t.y+t.height<n.y||n.y+n.height<t.y)}drawRoundRect(t){let[n,i,o,r]=t.layout,{rectRadius:a}=t.config,s=Math.min(a,o/4,r/4),l=this.colorMappings[t.node.id]||Ke,c=mt(n,i,o,r,{fill:l,padding:0,radius:s},{x:n,y:i,w:o,h:r});this.rectLayer.add(c);for(let h of t.children)this.drawRoundRect(h)}drawText(t){if(!t.node.label&&!t.node.isCombinedNode)return;let[n,i,o,r]=t.layout,{titleAreaHeight:a}=t.config,s=t.node.isCombinedNode?`+ ${t.node.originalNodeCount} Modules`:t.node.label,l=t.children&&t.children.length>0?a-Dt*2:r-Dt*2,c=o-Dt*2;if(c<=0||l<=0)return;let h={fontSize:this.config.font?.fontSize||Ue,family:this.config.font?.family||Qe,color:this.config.font?.color||Je},f=`${this.caches.getOrInsert(t.node.id,tn(this.render.ctx,s,h,c,l))}px ${h.family}`;this.render.ctx.font=f;let m=en(this.render.ctx,s,c,l);if(!m.valid)return;let{text:p}=m,y=n+Math.round(o/2),D=i+(t.children&&t.children.length>0?Math.round(a/2):Math.round(r/2)),g=me(p,y,D,f,h.color,{textX:y,textY:D});this.textLayer.add(g);for(let u of t.children)this.drawText(u)}draw(t=!0,n=!0){let{width:i,height:o}=this.render.options;if(n&&(this.layoutNodes=this.calculateLayoutNodes(this.data,{w:i,h:o,x:0,y:0})),t){let r=this.pluginDriver.cascadeHook("onModuleInit",this.layoutNodes);r&&(this.colorMappings=r.colorMappings||{})}for(let r of this.layoutNodes)this.drawRoundRect(r);for(let r of this.layoutNodes)this.drawText(r);this.add(this.rectLayer,this.textLayer),n&&this.update()}cleanup(){this.remove(this.rectLayer,this.textLayer),this.rectLayer.destory(),this.textLayer.destory()}calculateLayoutNodes(t,n,i=1){let o={titleAreaHeight:this.config.layout?.titleAreaHeight??$e,rectRadius:this.config.layout?.rectRadius??Ze,rectGap:this.config.layout?.rectGap??Dt},r=Vt(t,n,o,i),a=this.pluginDriver.cascadeHook("onLayoutCalculated",r,n,o);return a&&a.layoutNodes?.length?a.layoutNodes:r}};function tn(e,t,n,i,o){i=Math.floor(i),o=Math.floor(o);let{fontSize:r,family:a}=n,s=r.min,l=r.max;for(;l-s>=1;){let c=s+(l-s)/2;e.font=`${c}px ${a}`;let h=e.measureText(t).width,d=e.measureText(t),f=d.actualBoundingBoxAscent+d.actualBoundingBoxDescent;h<=i&&f<=o?s=c:l=c}return Math.floor(s)}function en(e,t,n,i){let o=e.measureText(t),r=o.width;if(o.actualBoundingBoxAscent+o.actualBoundingBoxDescent>i)return{valid:!1,text:"",direction:"horizontal",width:0};if(r<=n)return{valid:!0,text:t,direction:"horizontal",width:r};let s=e.measureText("...").width;if(n<=s)return{valid:!1,text:"",direction:"horizontal",width:0};let l=0,c=t.length,h="";for(;l<=c;){let d=Math.floor((l+c)/2),f=t.substring(0,d);e.measureText(f).width+s<=n?(h=f,l=d+1):c=d-1}return h.length>0?{valid:!0,text:h+"...",direction:"horizontal",width:n}:{valid:!0,text:"...",direction:"horizontal",width:s}}var be=["click","mousedown","mousemove","mouseup","mouseover","mouseout","wheel","contextmenu"],Te={IDLE:"IDLE",PRESSED:"PRESSED",DRAGGING:"DRAGGING",ZOOMING:"ZOOMING",MOVE:"MOVE",SCALING:"SCALING",PANNING:"PANNING"},jt=class{current;constructor(){this.current=Te.IDLE}canTransition(t){switch(this.current){case"IDLE":return t==="PRESSED"||t==="MOVE"||t==="SCALING"||t==="ZOOMING"||t==="PANNING";case"PRESSED":return t==="DRAGGING"||t==="IDLE";case"DRAGGING":return t==="IDLE";case"MOVE":return t==="PRESSED"||t==="IDLE";case"SCALING":return t==="IDLE";case"ZOOMING":return t==="IDLE";case"PANNING":return t==="IDLE";default:return!1}}transition(t){let n=this.canTransition(t);return n&&(this.current=t),n}reset(){this.current=Te.IDLE}isInState(t){return this.current===t}};function Kt(e){return e.kind==="wheel"}function $t(e){return e.kind==="contextmenu"}function nn(e,t,n){let i=o=>{let r={native:o};Object.defineProperty(r,"kind",{value:t,enumerable:!0,configurable:!1,writable:!1}),n.emit(t,r)};return e.addEventListener(t,i),{evt:t,handler:i}}var Et=class extends G{domEvents;el;currentModule;component;matrix;stateManager;constructor(t){super(),this.component=t,this.el=t.render.canvas,this.matrix=new B,this.currentModule=null,this.stateManager=new jt,this.domEvents=be.map(n=>nn(this.el,n,this)),be.forEach(n=>{this.on(n,i=>{this.dispatch(n,i)})})}destory(){if(this.el){this.domEvents.forEach(({evt:t,handler:n})=>this.el?.removeEventListener(t,n)),this.domEvents=[];for(let t in this.eventCollections)this.off(t);this.matrix.create(N)}}dispatch(t,n){let i=this.findRelativeNode(n);this.component.pluginDriver.runHook("onDOMEventTriggered",t,n,i,this),this.emit("__exposed__",t,{native:n.native,module:i})}findRelativeNode(t){return zt(de(this.el,t.native,1,1,this.matrix.e,this.matrix.f),this.component.layoutNodes)}};function De(e){let{plugins:t=[],graphic:n={}}=e||{},i=null,o=!1,r=null,a=null,s=new G;Array.isArray(t)||q.panic("Plugins should be an array");let l={init:c,dispose:h,resize:d,setOptions:f};function c(p){a=new ct(n,p),r=new Et(a),i=p,i.style.position="relative",o||(t.forEach(y=>a?.pluginDriver.use(y)),o=!0,a.pluginDriver.runHook("onLoad",l,r)),r.on("__exposed__",(y,D)=>s.emit(y,D))}function h(){if(i&&a&&r){r.destory(),a.destory(),i.removeChild(i.firstChild);for(let p in s.eventCollections)s.off(p);a.pluginDriver.runHook("onDispose"),i=null,a=null,r=null}}function d(){if(!a||!i)return;let{width:p,height:y}=i.getBoundingClientRect();a.render.initOptions({height:y,width:p,devicePixelRatio:window.devicePixelRatio}),a.render.canvas.style.position="absolute",r&&a.pluginDriver.runHook("onResize",r),a.cleanup(),a.draw()}function f(p){ye(a,q,"Treemap not initialized. Please call `init()` before setOptions."),a.data=Xt(p.data),d()}return ft(l,[{name:"on",fn:()=>s.on.bind(s)},{name:"off",fn:()=>s.off.bind(s)}])}var Zt=class extends K{reset(){this.destory(),this.update()}get canvas(){return this.render.canvas}setZIndexForHighlight(t="-1"){this.canvas.style.zIndex=t}init(){this.setZIndexForHighlight(),this.canvas.style.position="absolute",this.canvas.style.pointerEvents="none"}},X=300,on=.3,rn={desc:{r:255,g:255,b:255},mode:"rgb"},Ut={name:"treemap:preset-highlight",onLoad(){let e=this.getPluginMetadata("treemap:preset-highlight");e&&(e.highlight||(e.highlight=new Zt(this.instance.to)))},onDOMEventTriggered(e,t,n,{stateManager:i,matrix:o}){if(e==="mousemove"&&i.canTransition("MOVE")){let r=this.getPluginMetadata("treemap:preset-highlight");if(!n){r.highlight?.reset(),r.highlight?.update(),r.highlight?.setZIndexForHighlight(),r.highlightSeq=(r.highlightSeq??0)+1;return}let[a,s,l,c]=n.layout,h=Math.min(n.config.rectRadius,l/4,c/4);r.highlightSeq=(r.highlightSeq??0)+1;let d=r.highlightSeq;H((f,m)=>{if(r.highlightSeq!==d){r.highlight?.setZIndexForHighlight(),m();return}m(),r.highlight?.reset();let p=mt(a,s,l,c,{fill:rn,opacity:on,radius:h,padding:0});r.highlight?.add(p),r.highlight?.setZIndexForHighlight("1"),lt(p,o.e,o.f,1),r.highlight?.update()},{duration:X})}},onResize(){let e=this.getPluginMetadata("treemap:preset-highlight");e&&(e.highlight?.render.initOptions({...this.instance.render.options}),e.highlight?.reset(),e.highlight?.init())},onDispose(){let e=this.getPluginMetadata("treemap:preset-highlight");e&&e.highlight&&(e.highlight.destory(),e.highlight=null)},meta:{highlight:null,highlightSeq:0}};var Qt={name:"treemap:preset-drag-element",onDOMEventTriggered(e,t,n,i){let{stateManager:o,matrix:r,component:a}=i;switch(e){case"mousemove":{o.isInState("DRAGGING")?i.silent("click"):i.active("click");let s=Z.call(this);if(!s)return;if(s.dragOptions.x===0&&s.dragOptions.y===0){o.transition("IDLE");return}if(o.transition("DRAGGING"),o.isInState("DRAGGING")){let l=U.call(this);H((c,h)=>{h();let{offsetX:d,offsetY:f}=t.native,m=d-s.dragOptions.x,p=f-s.dragOptions.y,y=s.dragOptions.x,D=s.dragOptions.y;l?.highlight&&(l.highlight.reset(),l.highlight.setZIndexForHighlight()),r.translation(m,p),s.dragOptions.x=d,s.dragOptions.y=f,s.dragOptions.lastX=y,s.dragOptions.lastY=D;let g=a.elements.map(u=>Lt(u)?u.clone():u);return a.cleanup(),a.add(...g),st(a.elements,u=>{if(_t(u)){let{textX:x,textY:b}=u.__widget__;u.x=x,u.y=b}if(St(u)){let{x,y:b,w:M,h:A}=u.__widget__;u.x=x,u.y=b,u.width=M,u.height=A}lt(u,r.e,r.f,1)}),a.update(),!0},{duration:X,deps:[()=>o.isInState("IDLE")]})}break}case"mouseup":{if(o.isInState("PRESSED")){let s=Z.call(this);if(s&&s.dragOptions&&s.dragOptions.x===s.dragOptions.lastX&&s.dragOptions.y===s.dragOptions.lastY){o.transition("IDLE");return}}if(o.isInState("DRAGGING")&&o.canTransition("IDLE")){let s=U.call(this);s&&s.highlight&&(s.highlight.reset(),s.highlight.setZIndexForHighlight());let l=Z.call(this);l&&l.dragOptions&&(l.dragOptions.x=0,l.dragOptions.y=0,l.dragOptions.lastX=0,l.dragOptions.lastY=0,o.transition("IDLE"))}break}case"mousedown":{if(ge(t.native))return;let s=Z.call(this);if(!s)return;s.dragOptions.x=t.native.offsetX,s.dragOptions.y=t.native.offsetY,s.dragOptions.lastX=t.native.offsetX,s.dragOptions.lastY=t.native.offsetY,o.transition("PRESSED");break}}},meta:{dragOptions:{x:0,y:0,lastX:0,lastY:0}},onResize({matrix:e,stateManager:t}){e.create(N),t.reset()}};function U(){return this.getPluginMetadata("treemap:preset-highlight")}function Z(){return this.getPluginMetadata("treemap:preset-drag-element")}function Jt(e){let t=null,n=null,i=o=>{if(!n||!t)return;let r=o.target;if(r.parentNode){let s=r.parentNode.getAttribute("data-action");if(!s)return;e?.onClick&&e.onClick(s,n.findRelativeNode({native:o,kind:void 0}))}t.style.display="none"};return{name:"treemap:preset-menu",onDOMEventTriggered(o,r,a,s){if($t(r)){if(r.native.stopPropagation(),r.native.preventDefault(),!t){if(t=document.createElement("div"),n=s,Object.assign(t.style,{backgroundColor:"#fff",...e?.style,position:"absolute",zIndex:"9999"}),t.addEventListener("click",i),t&&e?.render){let l=e.render(t);t.innerHTML=l.map(c=>`<div data-action='${c.action}'>${c.html}</div>`).join("")}document.body.append(t)}t.style.left=r.native.clientX+"px",t.style.top=r.native.clientY+"px",t.style.display="initial"}},onDispose(){t&&(t.removeEventListener("click",i),t=null,n=null)}}}var te={name:"treemap:preset-color",onModuleInit(e){let t={};for(let n=0;n<e.length;n++){let i=e[n];Ee(t,i,Math.abs(at(i.node.id))%ce,0)}return{colorMappings:t}}};function Ee(e,t,n,i){let o=Math.abs(at(t.node.id))%60-30,r=(n+o)%360,a=Math.max(75-i*5,40),s=55-i*3,l=sn(r,a,s);if(e[t.node.id]=l,t.node.isCombinedNode&&t.node.originalNodes)for(let c of t.node.originalNodes)e[c.id]=l;if(t.children&&t.children.length){let c=t.children.length;for(let h=0;h<c;h++){let d=40*h/c,f=(r+d)%360;Ee(e,t.children[h],f,i+1)}}}function sn(e,t,n){return e=(e%360+360)%360,t=Math.min(Math.max(t,40),85),n=Math.min(Math.max(n,35),75),e>=60&&e<=180?(t=Math.max(t-10,40),n=Math.min(n+5,75)):e>=200&&e<=280?n=Math.min(n+8,75):e>=0&&e<=30&&(t=Math.max(t-5,40)),{mode:"hsl",desc:{h:e,s:t,l:n}}}function ee(e){return{name:"treemap:preset-scale",onDOMEventTriggered(t,n,i,o){Kt(n)&&ln(this,n,o)},meta:{scaleOptions:{scale:1,minScale:e?.min||.1,maxScale:e?.max||1/0,scaleFactor:.05},gestureState:{isTrackingGesture:!1,lastEventTime:0,eventCount:0,totalDeltaY:0,totalDeltaX:0,consecutivePinchEvents:0,gestureType:"unknown",lockGestureType:!1}},onResize({matrix:t,stateManager:n}){let i=ut.call(this);i&&(i.scaleOptions.scale=1),t.create(N),n.reset()}}}function ut(){return this.getPluginMetadata("treemap:preset-scale")}function an(e,t){let n=Date.now();if(n-t.lastEventTime>150?Object.assign(t,{isTrackingGesture:!1,lastEventTime:n,eventCount:1,totalDeltaY:Math.abs(e.deltaY),totalDeltaX:Math.abs(e.deltaX),consecutivePinchEvents:0,gestureType:"unknown",lockGestureType:!1}):(t.eventCount++,t.totalDeltaY+=Math.abs(e.deltaY),t.totalDeltaX+=Math.abs(e.deltaX),t.lastEventTime=n),e.ctrlKey||Math.abs(e.deltaX)>=100&&Math.abs(e.deltaX)<=10||Math.abs(e.deltaY)>50&&Math.abs(e.deltaX)<Math.abs(e.deltaY)*.1)return t.gestureType="zoom",t.lockGestureType=!0,"zoom";if(t.lockGestureType&&t.gestureType!=="unknown")return t.gestureType;if(t.eventCount>=3){let r=t.totalDeltaY/t.eventCount,s=t.totalDeltaX/t.eventCount/(r+.1);return r>8&&s<.3&&Math.abs(e.deltaY)>5?(t.gestureType="zoom",t.lockGestureType=!0,"zoom"):(t.gestureType="pan",t.lockGestureType=!0,"pan")}return"pan"}function ln(e,t,n){t.native.preventDefault();let i=ut.call(e);if(!i)return;an(t.native,i.gestureState)==="zoom"?cn(e,t,n):un(e,t,n)}function Oe(e,{stateManager:t,component:n,matrix:i},o=!1){let r=U.apply(e),a=()=>{r&&r.highlight&&(r.highlight.reset(),r.highlight.setZIndexForHighlight()),r&&(r.highlightSeq=(r.highlightSeq??0)+1),n.cleanup();let{width:s,height:l}=n.render.options;n.layoutNodes=n.calculateLayoutNodes(n.data,{w:s*i.a,h:l*i.d,x:0,y:0},1),n.draw(!0,!1),gt(n.elements,i.e,i.f,1),n.update(),t.canTransition("IDLE")&&t.transition("IDLE")};o?H((s,l)=>(l(),a(),!0),{duration:X}):a()}function cn(e,t,n){let{stateManager:i,matrix:o,component:r}=n,a=ut.call(e);if(!a)return;let{scale:s,minScale:l,maxScale:c,scaleFactor:h}=a.scaleOptions,d={e:o.e,f:o.f},f=Math.max(h,s*.1),m=t.native.deltaY<0?f:-f,p=Math.max(l,Math.min(c,s+m));if(p===s)return;i.transition("SCALING");let y=t.native.offsetX,D=t.native.offsetY,g=p/s;a.scaleOptions.scale=p,o.scale(g,g),o.e=y-(y-o.e)*g,o.f=D-(D-o.f)*g;let u={e:o.e,f:o.f};r.handleTransformCacheInvalidation(d,u),Oe(e,n,!1)}function un(e,t,n){let{stateManager:i,matrix:o}=n,r=.8,a=t.native.deltaX*r,s=t.native.deltaY*r;i.transition("PANNING"),o.e-=a,o.f-=s,Oe(e,n,!0)}var hn=2,Ce=.85,ne={name:"treemap:preset-zoomable",onLoad(e,{stateManager:t,matrix:n}){return ft(e,[{name:"zoom",fn:()=>i=>{let o=this.getPluginMetadata("treemap:preset-zoomable");if(!o||t.isInState("ZOOMING"))return;let r=this.resolveModuleById(i);if(!r)return;let a={e:n.e,f:n.f,a:n.a};o.previousMatrixState={e:n.e,f:n.f,a:n.a,d:n.d};let s=this.instance;t.transition("ZOOMING");let[l,c,h,d]=r.layout,{width:f,height:m}=s.render.options,p=n.a,y=f*Ce/h,D=m*Ce/d,g=Math.min(y,D),u=p*hn,x=Math.max(p,Math.min(g,u)),b=f/2,M=m/2,A=(l+h/2)/p,Y=(c+d/2)/p,F=b-A*x,z=M-Y*x,R=ut.call(this);R&&(R.scaleOptions.scale=x);let E=U.call(this),J=Z.call(this);J&&Object.assign(J.dragOptions,{x:0,y:0,lastX:0,lastY:0});let v={e:n.e,f:n.f,a:n.a,d:n.d},tt={e:F,f:z};s.handleTransformCacheInvalidation(a,tt),H(W=>{let _=he.cubicInOut(W);n.create(N),n.e=v.e+(F-v.e)*_,n.f=v.f+(z-v.f)*_,n.a=v.a+(x-v.a)*_,n.d=v.d+(x-v.d)*_,E?.highlight&&(E.highlight.reset(),E.highlight.setZIndexForHighlight()),E&&(E.highlightSeq=(E.highlightSeq??0)+1),s.cleanup(),s.layoutNodes=s.calculateLayoutNodes(s.data,{w:f*n.a,h:m*n.d,x:0,y:0},1),s.draw(!0,!1),gt(s.elements,n.e,n.f,1),s.update()},{duration:X,onStop:()=>{t.reset()}})}}])},meta:{isZooming:!1}};var Ae=document.querySelector("#app"),Q=De({plugins:[te,ne,Ut,Qt,ee(),Jt({style:{borderRadius:"5px",padding:"6px 3px",boxSizing:"border-box",cursor:"pointer",width:"120px",textAlign:"center",userSelect:"none"},render:()=>[{html:"<p>Zoom</p>",action:"zoom"},{html:"<p>Reset</p>",action:"reset"}],onClick(e,t){switch(e){case"zoom":{t?.node.id&&Q.zoom(t.node.id);break}case"reset":Q.resize()}}})]});function dn(){return fetch("data.json").then(e=>e.json()).then(e=>e)}function Pe(e){let t={...e};return e.children&&(t.groups=e.children.map(Pe)),t}async function pn(){let t=(await dn()).map(Pe),n=Mt(t.map(i=>vt(i,"value",o=>({...o,id:o.path,label:o.name}))),"weight");Q.setOptions({data:n})}Q.init(Ae);Q.on("click",function(){});pn().catch(console.error);new ResizeObserver(()=>Q.resize()).observe(Ae);var w=document.createElement("div");w.style.position="fixed";w.style.left="20px";w.style.bottom="20px";w.style.padding="10px";w.style.backgroundColor="rgba(0, 0, 0, 0.7)";w.style.color="white";w.style.borderRadius="5px";w.style.fontFamily="Arial, sans-serif";w.style.fontSize="14px";w.textContent="FPS: 0";document.body.appendChild(w);var we=0,ie=0,Re=0;function Ie(e){if(we!==0&&(ie++,e-Re>=1e3)){let t=ie;w.textContent=`FPS: ${t}`,ie=0,Re=e}we=e,requestAnimationFrame(Ie)}requestAnimationFrame(Ie);})();
</script>  </body>
</html>
